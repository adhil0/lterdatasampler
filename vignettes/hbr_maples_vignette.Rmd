---
title: "Health of Sugar Maple Seedlings (HBR)"
subtitle: "Response of Sugar Maple (Acer saccharum) to Calcium Addition at the Hubbard Brook Experimental Forest (Hubbard Brook LTER)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{hbr_maples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = 'center',
  fig.width=7, 
  fig.height=4,
  message = FALSE, warning = FALSE
)
```

### Dataset sample used

- `hbr_maples` 

# Introduction

Sugar maples (Acer saccharum) are a type of tree found at the Hubbard Brook LTER. These trees, known for things like maple syrup and their iconic leaf shape, have been compromised by decades of acid rain.

Researchers have treated the W1 watershed with calcium to see if it helps restore the health of sugar maple seedlings.

# Data Exploration

```{r setup}
library(lterdatasets)
library(tidyverse)
```
Let's explore the dataset:

```{r}
head(hbr_maples)
```

One way we can measure seedling health is through their heights. Are there any differences in height between the two watersheds?

```{r}
boxplot_watershed <-
  ggplot(data = hbr_maples, aes(x = watershed, y = stem_length)) +
  geom_boxplot(aes(color = watershed, shape = watershed),
               alpha = 0.8,
               width = 0.5) +
  geom_jitter(
    aes(color = watershed),
    alpha = 0.5,
    show.legend = FALSE,
    position = position_jitter(width = 0.2, seed = 0)
  ) +
  labs(x = "Watershed", y = "Stem Length", title = "Stem Lengths of Sugar Maple Seedlings", subtitle = "Hubbard Brook LTER") +
  theme_minimal()

boxplot_watershed
```

The two watersheds are independent from one another, and according to the documentation, the data consists of a random sample of the seedlings present in each watershed. Because of this, we can use a two-sample t-test to help us in determining whether or not calcium treatment is effective in increasing the height of sugar maple seedlings.

However, there are some assumptions that need to be checked before a t-test is used. Both groups need to be normally distributed with equal variances.

Is the data normally distributed?

```{r}
density_curve <- ggplot(data = hbr_maples, aes(stem_length)) +
  geom_density() +
  theme_minimal() +
  labs(x = "Stem Length (mm)", y = "Density", title = "Distribution of Sugar Maple Seedling Stem Lengths", subtitle = "Hubbard Brook LTER")

density_curve
```

```{r}
density_watershed <-
  ggplot(data = hbr_maples, aes(stem_length)) +
  geom_density(aes(color = watershed)) +
  theme_minimal() +
  labs(x = "Stem Length (mm)", y = "Density", title = "Distribution of Sugar Maple Seedling Stem Lengths By Watershed", subtitle = "Hubbard Brook LTER")

density_watershed
```

```{r}
qq_reference <- ggplot(data = hbr_maples %>% filter(watershed == "Reference")) + 
  geom_qq(aes(sample = stem_length)) + 
  geom_qq_line(aes(sample = stem_length)) +
  labs(title = "Q-Q Plot for Reference Watershed Stem Lengths", subtitle = "Hubbard Brook LTER") +
  theme_minimal()

qq_reference
```

```{r}
qq_calcium <- ggplot(data = hbr_maples %>% filter(watershed == "W1")) + 
  geom_qq(aes(sample = stem_length)) + 
  geom_qq_line(aes(sample = stem_length)) +
  labs(title = "Q-Q Plot for Calcium Watershed Stem Lengths", subtitle = "Hubbard Brook LTER") +
  theme_minimal()

qq_calcium
```

Both watershed distributions appear to be normally distributed according to the density and Q-Q plots. Now we can use `var.test` to see if they have equal variances. 

Our hypotheses will be:

$H_0:$ Ratio of variances is equal to 1

$H_A:$ Ratio of variances is not equal to 1
 
```{r}
var.test(
 x = hbr_maples %>% filter(watershed == "Reference") %>% pull(stem_length),
 y = hbr_maples %>% filter(watershed == "W1") %>% pull(stem_length)
)
```

Since the p-value is not significant, we fail to reject the null hypothesis that the ratio of the variances of the two watersheds is equal to 1. In other words, the variances are likely to be equal.

Since we have confirmed that both groups are normally distributed with equal variances, we can now do a two-sample t-test using `t.test()` to determine if there is a statistically significant difference in mean stem length between the watersheds. 

Our hypotheses will be:

$H_0: \mu_{1} - \mu_2 = 0$

$H_A: \mu_{1} - \mu_2 < 0$

By default, `t.test()` will use Welch's test to correct for unequal variances, so set `var.equal = TRUE`. Since we are interested in seeing if the mean stem length for the reference watershed is less than that of the calcium-treated watershed, set `alternative = "less"`:

```{r}
t.test(stem_length ~ watershed, alternative = "less", var.equal = TRUE, data = hbr_maples)
```

Since there is a p-value < 0.05, we can reject the null hypothesis and say that the true difference in means is likely less than 0, and that the calcium treatment may be effective in helping sugar maples become healthier.

# Further Analysis

There are some relationships in this dataset that could examined more:

```{r}
stem_plot <- ggplot(hbr_maples) + geom_point(aes(x=stem_length, y = stem_dry_mass)) + labs(x = "Stem Length (mm)", y = "Stem Dry Mass (g)", title = "Stem Dry Mass vs. Stem Length in Sugar Maple Seedlings", subtitle = "Hubbard Brook LTER") + theme_minimal()
stem_plot
```

Now color each point based on the year of observation:

```{r}
stem_year <- ggplot(hbr_maples) + geom_point(aes(x=stem_length, y = stem_dry_mass, color = factor(year))) + labs(x = "Stem Length (mm)", y = "Stem Dry Mass (g)", title = "Stem Dry Mass vs. Stem Length in Sugar Maple Seedlings", subtitle = "Hubbard Brook LTER", color = "year") + theme_minimal()
stem_year
```

Clearly, we can see that there are two groups in the data, which are seperated based on year.

We can also use `facet_wrap` to see if there were any differences between treatments:
```{r}
stem_year + facet_wrap(~watershed)
```

It looks like there weren't many differences between the two treatments. You could try using weighted least squares and clustering to investigate this relationship further.

----------------------------------

Outlier Analysis: You could examine the relationship between `corrected_leaf_area` and `leaf_dry_mass` before and after the outlier is removed.

```{r}
outlier_plot <- ggplot(hbr_maples) + 
  geom_point(aes(x=corrected_leaf_area, y = leaf_dry_mass)) + 
  labs(x = "Corrected Leaf Area (sq. cm)", y = "Leaf Dry Mass (g)", title = "Leaf Dry Mass vs. Corrected Leaf Area in Sugar Maple Seedlings", subtitle = "Hubbard Brook LTER") +
  theme_minimal()
outlier_plot
```

----------------------------------

```{r}
leaf_linear <- ggplot(hbr_maples) + 
  geom_point(aes(x=leaf1area, y = leaf2area)) +
  labs(x = "Leaf 1 Area (sq. cm)", y = "Leaf 2 Area (sq. cm)", title = "Leaf 1 Area vs. Leaf 2 Area in Sugar Maple Seedlings", subtitle = "Hubbard Brook LTER") +
  theme_minimal()
leaf_linear
```

... and many more!

# Citation

Juice, S. and T. Fahey. 2019. Health and mycorrhizal colonization response of sugar maple (Acer saccharum) seedlings to calcium addition in Watershed 1 at the Hubbard Brook Experimental Forest ver 3. Environmental Data Initiative. https://doi.org/10.6073/pasta/0ade53ede9a916a36962799b2407097e (Accessed 2021-05-17).

# How we processed the raw data

`r knitr::spin_child(here::here("data-raw", "hbr_maples_data.R"))`
